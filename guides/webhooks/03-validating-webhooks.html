<!DOCTYPE html><html class=no-js><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Webhooks | Dwolla API</title><meta name=description content="Webhooks for payments within your application by utilizing our open API with no per transaction fees."><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/main.c3ea.css><link rel=stylesheet href="//fonts.googleapis.com/css?family=Roboto+Slab:300|Open+Sans:300,400,600,700"><script src=/js/head-scripts.32fa.js></script></head><body><!--[if lt IE 8]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]--><header><div class="header__primary page-wrap"><div><a href="/" class="logo icon-logo-dwolla-white">Dwolla</a><div class=hamburger><a href=http://dwolla.com/register>Sign Up</a> <a class="btn primary js-hamburger">Menu</a></div></div><nav class=js-hamburger-nav><a href=https://www.dwolla.com/about>Product</a> <a href="/">API</a> <a href="https://www.dwolla.com/contact?b=nav">Contact sales</a> <a href=http://dwolla.com/login>Log in</a> <a class="btn primary" href=http://dwolla.com/register>Sign Up</a></nav></div><nav class="header__secondary js-two-col-nav-toggle"><div class=page-wrap><a href="/guides/" class=active>Guides</a> <a href="/resources/">Resources</a> <a href=/pages/api-docs.html>API Docs</a> <a href=/pages/sdks.html class="no-nav js-two-col-no-toggle">SDKs</a><div class="custom-select custom-select--blue"><select name=select id=language_select><option value=raw>raw</option><option value=php>php</option><option value=ruby>ruby</option><option value=python>python</option><option value=javascript>javascript</option></select><div class=arrow></div></div></div></nav></header><div class=content><div class=cnt-two-col><div class=page-wrap><section class="cnt-two-col__nav js-two-col-nav"><nav class="side-nav active"><section class=side-nav__dropdown><h6>Choose a guide</h6><div class=picker id=js-sidenav-dropdown-button><button>Webhooks</button><div class="icon icon-side-nav-collapse-plus"></div><div class="icon icon-side-nav-collapse-minus"></div></div><nav id=js-sidenav-dropdown-nav><a href=/guides/sandbox-setup>Set up sandbox</a> <a href="/guides/send-money/">Send money to your users</a> <a href="/guides/receive-money/">Receive money from your users</a> <a href="/guides/transfer-money-between-users/">Transfer money between users</a> <a href="/guides/webhooks/">Webhooks</a></nav></section><section class=side-nav__dropdown style=display:none><h6>Tools</h6><ul><li><a href=/resources/sandbox.html>Sandbox</a></li><li><a href=https://developers.dwolla.com/dev/token target=_blank class=icon-sidenav-option>Token generator</a></li><li><a href=/resources/changelog.html>Change log</a></li><li><a href="http://status.dwolla.com/" target=_blank class=icon-sidenav-option>Status</a></li></ul><h6>Articles</h6><ul><li><a href=/resources/account-types.html>Types of accounts</a></li><li><a href=/resources/customer-verification.html>Customer verification</a></li><li><a href=/resources/oauth-refresh-strategies.html>OAuth refresh stategies</a></li></ul></section><section class=steps-nav style=display:none><h6>Follow the steps</h6><ol><li><a href=/guides/send-money>Overview: send money to your users</a><div class=dot></div><ol><li><a href=/guides/send-money/01-white-label-onboarding.html>Option 1: White label</a><div class=dot></div></li><li><a href=/guides/send-money/01-direct-onboarding.html>Option 2: Dwolla Direct</a><div class=dot></div></li></ol></li><li><a href=/guides/send-money/02-fetch-funding-sources.html>Fetch funding sources</a><div class=dot></div></li><li><a href=/guides/send-money/03-create-transfer.html class=active>Create a transfer</a><div class=dot></div></li><li><a href=/guides/send-money/04-check-transfer.html>Check transfer status</a><div class=dot></div></li></ol></section><section class=side-nav__options style=display:none><h6>Options</h6><ul><li><a href=https://developers.dwolla.com/dev/pages/guides/masspay target=_blank class=icon-sidenav-option>MassPay V1</a></li><li><a href="" class=icon-sidenav-option>Recurring and Scheduled V1</a></li></ul></section><section class=steps-nav style=display:none><h6>Follow the steps</h6><ol><li><a href=/guides/sandbox-setup>Overview: send money to your users</a><div class=dot></div></li><li><a href=/guides/sandbox-setup/01-create-master-account.html>Create a master Sandbox account</a><div class=dot></div></li><li><a href=/guides/sandbox-setup/02-create-child-account.html>Create a child Sandbox account</a><div class=dot></div></li><li><a href=/guides/sandbox-setup/03-create-application.html class=active>Create an application</a><div class=dot></div></li><li><a href=/guides/sandbox-setup/04-enable-sdk-sandbox-mode.html>Enable Sandbox mode</a><div class=dot></div></li></ol></section><section class=steps-nav><h6>Follow the steps</h6><ol><li><a href=/guides/webhooks>Overview</a><div class=dot></div></li><li><a href=/guides/webhooks/01-obtain-authorization.html>Obtain authorization</a><div class=dot></div></li><li><a href=/guides/webhooks/02-create-subscription.html>Create a webhook subscription</a><div class=dot></div></li><li><a href=/guides/webhooks/03-validating-webhooks.html class=active>Validating webhooks</a><div class=dot></div></li><li><a href=/guides/webhooks/04-process-webhooks.html>Processing webhooks</a><div class=dot></div></li></ol></section></nav></section><section class=cnt-two-col__content><h1>Validating webhooks</h1><p>Assume that your integration is an online marketplace, and that a customer just placed an order on your site. A few days after the customer initiated their payment, your application receives this webhook.</p><div class="code-snippet js-code-snippet language-raw"><button class="btn alternative">copy</button><div class=code-snippet__selector><nav><button class=selector_switch id=raw>raw</button> <button class=selector_switch id=php>php</button> <button class=selector_switch id=ruby>ruby</button> <button class=selector_switch id=python>python</button> <button class=selector_switch id=javascript>javascript</button></nav></div><div class="code-snippet__cnt highlight"><pre><code class=language-raw data-lang=raw>{
  "id": "2c311238-b9ef-4763-b1cb-03e1aa651227",
  "resourceId": "0089A051-9B79-E511-80DB-0AA34A9B2388",
  "topic": "transfer_completed",
  "timestamp": "2015-10-23T15:35:35.366Z",
  "_links": {
    "self": {
      "href": "https://api-uat.dwolla.com/events/2c311238-b9ef-4763-b1cb-03e1aa651227"
    },
    "account": {
      "href": "https://api-uat.dwolla.com/accounts/b4cdac07-eeca-4059-a29c-48900e453d54"
    },
    "resource": {
      "href": "https://api-uat.dwolla.com/transfers/0089A051-9B79-E511-80DB-0AA34A9B2388"
    }
  }
}

</code></pre></div></div><div class="code-snippet js-code-snippet language-ruby"><button class="btn alternative">copy</button><div class=code-snippet__selector><nav><button class=selector_switch id=raw>raw</button> <button class=selector_switch id=php>php</button> <button class=selector_switch id=ruby>ruby</button> <button class=selector_switch id=python>python</button> <button class=selector_switch id=javascript>javascript</button></nav></div><div class="code-snippet__cnt highlight"><pre><code class=language-ruby data-lang=ruby><span class=no>No</span> <span class=n>example</span> <span class=k>for</span> <span class=n>this</span> <span class=n>language</span> <span class=n>yet</span><span class=o>.</span>
</code></pre></div></div><div class="code-snippet js-code-snippet language-javascript"><button class="btn alternative">copy</button><div class=code-snippet__selector><nav><button class=selector_switch id=raw>raw</button> <button class=selector_switch id=php>php</button> <button class=selector_switch id=ruby>ruby</button> <button class=selector_switch id=python>python</button> <button class=selector_switch id=javascript>javascript</button></nav></div><div class="code-snippet__cnt highlight"><pre><code class=language-javascript data-lang=javascript><span class=nx>No</span> <span class=nx>example</span> <span class=k>for</span> <span class=k>this</span> <span class=nx>language</span> <span class=nx>yet</span><span class=p>.</span>
</code></pre></div></div><div class="code-snippet js-code-snippet language-python"><button class="btn alternative">copy</button><div class=code-snippet__selector><nav><button class=selector_switch id=raw>raw</button> <button class=selector_switch id=php>php</button> <button class=selector_switch id=ruby>ruby</button> <button class=selector_switch id=python>python</button> <button class=selector_switch id=javascript>javascript</button></nav></div><div class="code-snippet__cnt highlight"><pre><code class=language-python data-lang=python><span class=n>No</span> <span class=n>example</span> <span class=k>for</span> <span class=n>this</span> <span class=n>language</span> <span class=n>yet</span><span class=o>.</span>
</code></pre></div></div><div class="code-snippet js-code-snippet language-php"><button class="btn alternative">copy</button><div class=code-snippet__selector><nav><button class=selector_switch id=raw>raw</button> <button class=selector_switch id=php>php</button> <button class=selector_switch id=ruby>ruby</button> <button class=selector_switch id=python>python</button> <button class=selector_switch id=javascript>javascript</button></nav></div><div class="code-snippet__cnt highlight"><pre><code class=language-php data-lang=php>No example for this language yet.
</code></pre></div></div><h4>Step 1: Authenticating the webhook request</h4><p>Before we process any data from the webhook we’ll want to validate that the request really came from Dwolla and not someone pretending to be Dwolla. Dwolla signs each webhook request with the <code>secret</code> you passed in when you created the webhook subscription. The signature is contained in the <code>X-Request-Signature</code> header and is a SHA-1 HMAC hash of the request body with the key being your webhook secret.</p><p>You can validate the webhook by generating the same SHA-1 HMAC hash and comparing it to the signature sent with the payload.</p><div class="code-snippet js-code-snippet language-ruby"><button class="btn alternative">copy</button><div class=code-snippet__selector><nav><button class=selector_switch id=raw>raw</button> <button class=selector_switch id=php>php</button> <button class=selector_switch id=ruby>ruby</button> <button class=selector_switch id=python>python</button> <button class=selector_switch id=javascript>javascript</button></nav></div><div class="code-snippet__cnt highlight"><pre><code class=language-ruby data-lang=ruby><span class=k>def</span> <span class=nf>verify_signature</span><span class=p>(</span><span class=n>payload_body</span><span class=p>,</span> <span class=n>request_signature</span><span class=p>)</span>
  <span class=n>signature</span> <span class=o>=</span> <span class=no>OpenSSL</span><span class=o>::</span><span class=no>HMAC</span><span class=p>.</span><span class=nf>hexdigest</span><span class=p>(</span><span class=no>OpenSSL</span><span class=o>::</span><span class=no>Digest</span><span class=p>.</span><span class=nf>new</span><span class=p>(</span><span class=s2>"sha1"</span><span class=p>),</span>
<span class=no>ENV</span><span class=p>[</span><span class=s2>"DWOLLA_WEBHOOK_SECRET"</span><span class=p>],</span>
<span class=n>payload_body</span><span class=p>)</span>
  <span class=k>unless</span> <span class=no>Rack</span><span class=o>::</span><span class=no>Utils</span><span class=p>.</span><span class=nf>secure_compare</span><span class=p>(</span><span class=n>signature</span><span class=p>,</span> <span class=n>request_signature</span><span class=p>)</span>
    <span class=n>halt</span> <span class=mi>500</span><span class=p>,</span> <span class=s2>"Signatures didn't match!"</span>
  <span class=k>end</span>
<span class=k>end</span>
</code></pre></div></div><div class="code-snippet js-code-snippet language-raw"><button class="btn alternative">copy</button><div class=code-snippet__selector><nav><button class=selector_switch id=raw>raw</button> <button class=selector_switch id=php>php</button> <button class=selector_switch id=ruby>ruby</button> <button class=selector_switch id=python>python</button> <button class=selector_switch id=javascript>javascript</button></nav></div><div class="code-snippet__cnt highlight"><pre><code class=language-raw data-lang=raw>No example for this language yet.
</code></pre></div></div><div class="code-snippet js-code-snippet language-javascript"><button class="btn alternative">copy</button><div class=code-snippet__selector><nav><button class=selector_switch id=raw>raw</button> <button class=selector_switch id=php>php</button> <button class=selector_switch id=ruby>ruby</button> <button class=selector_switch id=python>python</button> <button class=selector_switch id=javascript>javascript</button></nav></div><div class="code-snippet__cnt highlight"><pre><code class=language-javascript data-lang=javascript><span class=nx>No</span> <span class=nx>example</span> <span class=k>for</span> <span class=k>this</span> <span class=nx>language</span> <span class=nx>yet</span><span class=p>.</span>
</code></pre></div></div><div class="code-snippet js-code-snippet language-python"><button class="btn alternative">copy</button><div class=code-snippet__selector><nav><button class=selector_switch id=raw>raw</button> <button class=selector_switch id=php>php</button> <button class=selector_switch id=ruby>ruby</button> <button class=selector_switch id=python>python</button> <button class=selector_switch id=javascript>javascript</button></nav></div><div class="code-snippet__cnt highlight"><pre><code class=language-python data-lang=python><span class=n>No</span> <span class=n>example</span> <span class=k>for</span> <span class=n>this</span> <span class=n>language</span> <span class=n>yet</span><span class=o>.</span>
</code></pre></div></div><div class="code-snippet js-code-snippet language-php"><button class="btn alternative">copy</button><div class=code-snippet__selector><nav><button class=selector_switch id=raw>raw</button> <button class=selector_switch id=php>php</button> <button class=selector_switch id=ruby>ruby</button> <button class=selector_switch id=python>python</button> <button class=selector_switch id=javascript>javascript</button></nav></div><div class="code-snippet__cnt highlight"><pre><code class=language-php data-lang=php>No example for this language yet.
</code></pre></div></div><h4>Step 2: Check for duplicate events</h4><p>The <code>topic</code> field of an event holds <a href=http://docsv2.dwolla.com/#events>a description</a> of the event (think of it as you would the subject of an e-mail message). The <code>webhook</code> itself contains _links the the resource impacted by the event that can be used to retrieve more information about the webhook you have received.</p><p><strong>NOTE</strong>: The <code>event</code> must be retrieved with a <code>client_credentials</code> granted access_token.</p><div class="code-snippet js-code-snippet language-ruby"><button class="btn alternative">copy</button><div class=code-snippet__selector><nav><button class=selector_switch id=raw>raw</button> <button class=selector_switch id=php>php</button> <button class=selector_switch id=ruby>ruby</button> <button class=selector_switch id=python>python</button> <button class=selector_switch id=javascript>javascript</button></nav></div><div class="code-snippet__cnt highlight"><pre><code class=language-ruby data-lang=ruby><span class=nb>require</span> <span class=s1>'dwolla_swagger'</span>

<span class=c1>## Assuming Rails-style POST parameter</span>
<span class=k>if</span> <span class=n>params</span><span class=p>[</span><span class=ss>:webhook</span><span class=p>]</span> <span class=o>==</span> <span class=s1>'transfer_completed'</span>
  <span class=n>event</span> <span class=o>=</span> <span class=no>DwollaSwagger</span><span class=o>::</span><span class=no>EventsApi</span><span class=p>.</span><span class=nf>id</span><span class=p>(</span><span class=n>params</span><span class=p>[</span><span class=ss>:webhook</span><span class=p>][</span><span class=ss>:eventId</span><span class=p>])</span>
<span class=k>elsif</span> <span class=n>params</span><span class=p>[</span><span class=ss>:webhook</span><span class=p>]</span> <span class=o>==</span> <span class=s1>'another_event'</span>
  <span class=s2>"..."</span>
<span class=k>end</span>
</code></pre></div></div><div class="code-snippet js-code-snippet language-raw"><button class="btn alternative">copy</button><div class=code-snippet__selector><nav><button class=selector_switch id=raw>raw</button> <button class=selector_switch id=php>php</button> <button class=selector_switch id=ruby>ruby</button> <button class=selector_switch id=python>python</button> <button class=selector_switch id=javascript>javascript</button></nav></div><div class="code-snippet__cnt highlight"><pre><code class=language-raw data-lang=raw>No example for this language yet.
</code></pre></div></div><div class="code-snippet js-code-snippet language-javascript"><button class="btn alternative">copy</button><div class=code-snippet__selector><nav><button class=selector_switch id=raw>raw</button> <button class=selector_switch id=php>php</button> <button class=selector_switch id=ruby>ruby</button> <button class=selector_switch id=python>python</button> <button class=selector_switch id=javascript>javascript</button></nav></div><div class="code-snippet__cnt highlight"><pre><code class=language-javascript data-lang=javascript><span class=nx>No</span> <span class=nx>example</span> <span class=k>for</span> <span class=k>this</span> <span class=nx>language</span> <span class=nx>yet</span><span class=p>.</span>
</code></pre></div></div><div class="code-snippet js-code-snippet language-python"><button class="btn alternative">copy</button><div class=code-snippet__selector><nav><button class=selector_switch id=raw>raw</button> <button class=selector_switch id=php>php</button> <button class=selector_switch id=ruby>ruby</button> <button class=selector_switch id=python>python</button> <button class=selector_switch id=javascript>javascript</button></nav></div><div class="code-snippet__cnt highlight"><pre><code class=language-python data-lang=python><span class=n>No</span> <span class=n>example</span> <span class=k>for</span> <span class=n>this</span> <span class=n>language</span> <span class=n>yet</span><span class=o>.</span>
</code></pre></div></div><div class="code-snippet js-code-snippet language-php"><button class="btn alternative">copy</button><div class=code-snippet__selector><nav><button class=selector_switch id=raw>raw</button> <button class=selector_switch id=php>php</button> <button class=selector_switch id=ruby>ruby</button> <button class=selector_switch id=python>python</button> <button class=selector_switch id=javascript>javascript</button></nav></div><div class="code-snippet__cnt highlight"><pre><code class=language-php data-lang=php>No example for this language yet.
</code></pre></div></div><p>Multiple webhooks are fired for <code>Transfer</code> events, that is, two <code>transfer_created</code> events with different URLs will be fired, one for each customer. To avoid doing any business logic twice, you would have to check if you have already received a webhook relating to the <code>Transfer</code> resource responsible for the event. To do this, keep a queue of events in a database and check to see if an <code>Event</code> has the same <code>self</code> resource location in <code>_links</code> as another event. If not, process the logic for that event. An example could look like this.</p><div class="code-snippet js-code-snippet language-ruby"><button class="btn alternative">copy</button><div class=code-snippet__selector><nav><button class=selector_switch id=raw>raw</button> <button class=selector_switch id=php>php</button> <button class=selector_switch id=ruby>ruby</button> <button class=selector_switch id=python>python</button> <button class=selector_switch id=javascript>javascript</button></nav></div><div class="code-snippet__cnt highlight"><pre><code class=language-ruby data-lang=ruby><span class=n>check_db</span> <span class=o>=</span> <span class=no>ActiveRecord</span><span class=o>::</span><span class=no>Base</span><span class=p>.</span><span class=nf>connection</span><span class=p>.</span><span class=nf>execute</span><span class=p>(</span><span class=s2>"SELECT * FROM EVENTS WHERE SELF = </span><span class=si>#{</span><span class=n>event</span><span class=p>[</span><span class=ss>:_links</span><span class=p>][</span><span class=ss>:self</span><span class=p>].</span><span class=nf>to_s</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>

<span class=c1># check_db will be an array of rows returned</span>
<span class=k>unless</span> <span class=n>check_db</span><span class=p>.</span><span class=nf>length</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span>
    <span class=c1># do something</span>
<span class=k>end</span>
</code></pre></div></div><div class="code-snippet js-code-snippet language-raw"><button class="btn alternative">copy</button><div class=code-snippet__selector><nav><button class=selector_switch id=raw>raw</button> <button class=selector_switch id=php>php</button> <button class=selector_switch id=ruby>ruby</button> <button class=selector_switch id=python>python</button> <button class=selector_switch id=javascript>javascript</button></nav></div><div class="code-snippet__cnt highlight"><pre><code class=language-raw data-lang=raw>No example for this language yet.
</code></pre></div></div><div class="code-snippet js-code-snippet language-javascript"><button class="btn alternative">copy</button><div class=code-snippet__selector><nav><button class=selector_switch id=raw>raw</button> <button class=selector_switch id=php>php</button> <button class=selector_switch id=ruby>ruby</button> <button class=selector_switch id=python>python</button> <button class=selector_switch id=javascript>javascript</button></nav></div><div class="code-snippet__cnt highlight"><pre><code class=language-javascript data-lang=javascript><span class=nx>No</span> <span class=nx>example</span> <span class=k>for</span> <span class=k>this</span> <span class=nx>language</span> <span class=nx>yet</span><span class=p>.</span>
</code></pre></div></div><div class="code-snippet js-code-snippet language-python"><button class="btn alternative">copy</button><div class=code-snippet__selector><nav><button class=selector_switch id=raw>raw</button> <button class=selector_switch id=php>php</button> <button class=selector_switch id=ruby>ruby</button> <button class=selector_switch id=python>python</button> <button class=selector_switch id=javascript>javascript</button></nav></div><div class="code-snippet__cnt highlight"><pre><code class=language-python data-lang=python><span class=n>No</span> <span class=n>example</span> <span class=k>for</span> <span class=n>this</span> <span class=n>language</span> <span class=n>yet</span><span class=o>.</span>
</code></pre></div></div><div class="code-snippet js-code-snippet language-php"><button class="btn alternative">copy</button><div class=code-snippet__selector><nav><button class=selector_switch id=raw>raw</button> <button class=selector_switch id=php>php</button> <button class=selector_switch id=ruby>ruby</button> <button class=selector_switch id=python>python</button> <button class=selector_switch id=javascript>javascript</button></nav></div><div class="code-snippet__cnt highlight"><pre><code class=language-php data-lang=php>No example for this language yet.
</code></pre></div></div><nav class=pager-nav><a href=02-create-subscription.html>Back: Create a webhook subscription</a> <a href=04-process-webhooks.html>Next step: Processing webhooks</a></nav></section></div></div></div><section class=big-disclaimer><div class=page-wrap><h5>Financial institutions play an important role in the Dwolla network.</h5><p>Dwolla, Inc. is an agent of Veridian Credit Union and all funds associated with your account in the Dwolla network are held in a pooled account at Veridian Credit Union. These funds are not eligible for individual insurance, and may not be eligible for share insurance by the National Credit Union Share Insurance Fund. Dwolla, Inc. is the operator of a software platform that communicates user instructions for funds transfers to Veridian Credit Union.</p></div></section><footer><div class=page-wrap><nav><a href="https://www.dwolla.com/pricing?b=footer">Pricing</a> <a href="https://www.dwolla.com/contact?b=footer">Contact sales</a> <a href="http://help.dwolla.com/">Support</a> <a href=https://www.dwolla.com/security>Security</a> <a href="http://blog.dwolla.com/">Blog</a> <a href="http://press.dwolla.com/">Press</a> <a href=https://www.dwolla.com/careers>Careers</a></nav><nav class=disclaimer><span>© 2015 Dwolla, Inc</span> <a href="https://legal.dwolla.com/privacy/">Privacy</a> <a href="https://legal.dwolla.com/tos/">Legal</a> <a href="https://legal.dwolla.com/about-our-financial-institution-partner/">Dwolla, Inc. is an agent of its Financial Institution Partner(s)</a></nav></div></footer><script src=//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js></script><script>window.jQuery || document.write('<script src="/_bower_components/jquery/jquery.min.js"><\/script>')</script><script src=/js/script.1120.js></script><!-- Google Analytics: change UA-XXXXX-X to be your site's ID. --><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
  function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
  e=o.createElement(i);r=o.getElementsByTagName(i)[0];
  e.src='//www.google-analytics.com/analytics.js';
  r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
  ga('create','UA-30404064-1');ga('send','pageview');</script></body></html>